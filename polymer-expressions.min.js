define("polymer-expressions/ast_factory",["require","exports"],function(t,e){"use strict";var r=function(){function t(){}return t.prototype.empty=function(){return{type:"Empty"}},t.prototype.literal=function(t){return{type:"Literal",value:t}},t.prototype.id=function(t){return{type:"ID",value:t}},t.prototype.unary=function(t,e){return{type:"Unary",operator:t,child:e}},t.prototype.binary=function(t,e,r){return{type:"Binary",operator:e,left:t,right:r}},t.prototype.getter=function(t,e){return{type:"Getter",receiver:t,name:e}},t.prototype.invoke=function(t,e,r){if(null==r)throw new Error("args");return{type:"Invoke",receiver:t,method:e,arguments:r}},t.prototype.paren=function(t){return t},t.prototype.index=function(t,e){return{type:"Index",receiver:t,argument:e}},t.prototype.ternary=function(t,e,r){return{type:"Ternary",condition:t,trueExpr:e,falseExpr:r}},t.prototype.map=function(t){return{type:"Map",entries:t}},t.prototype.list=function(t){return{type:"List",items:t}},t}();e.AstFactory=r}),define("polymer-expressions/eval",["require","exports"],function(t,e){"use strict";var r={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"==":function(t,e){return t==e},"!=":function(t,e){return t!=e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},">":function(t,e){return t>e},">=":function(t,e){return t>=e},"<":function(t,e){return e>t},"<=":function(t,e){return e>=t},"||":function(t,e){return t||e},"&&":function(t,e){return t&&e},"|":function(t,e){return e(t)}},n={"+":function(t){return t},"-":function(t){return-t},"!":function(t){return!t}};e.createScope=function(t){var e=Object.create(t);return e["this"]=e["this"]||t,e};var i=function(){function t(){}return t.prototype.empty=function(){return{type:"Empty",evaluate:function(t){return t},getIds:function(t){return t}}},t.prototype.literal=function(t){return{type:"Literal",value:t,evaluate:function(t){return this.value},getIds:function(t){return t}}},t.prototype.id=function(t){return{type:"ID",value:t,evaluate:function(t){return"this"===this.value?t:t[this.value]},getIds:function(t){return t.push(this.value),t}}},t.prototype.unary=function(t,e){var r=n[t];return{type:"Unary",operator:t,child:e,evaluate:function(t){return r(this.child.evaluate(t))},getIds:function(t){return this.child.getIds(t)}}},t.prototype.binary=function(t,e,n){var i=r[e];return{type:"Binary",operator:e,left:t,right:n,evaluate:function(t){return i(this.left.evaluate(t),this.right.evaluate(t))},getIds:function(t){return this.left.getIds(t),this.right.getIds(t),t}}},t.prototype.getter=function(t,e){return{type:"Getter",receiver:t,name:e,evaluate:function(t){return this.receiver.evaluate(t)[this.name]},getIds:function(t){return this.receiver.getIds(t),t}}},t.prototype.invoke=function(t,e,r){if(null!=e&&"string"!=typeof e)throw new Error("method not a string");return{type:"Invoke",receiver:t,method:e,arguments:r,evaluate:function(t){var r=this.receiver.evaluate(t),n=this.method?r:t["this"]||t,i=this.method?r[e]:r,s=this.arguments.map(function(e){return e.evaluate(t)});return i.apply(n,s)},getIds:function(t){return this.receiver.getIds(t),this.arguments.forEach(function(e){return e.getIds(t)}),t}}},t.prototype.paren=function(t){return t},t.prototype.index=function(t,e){return{type:"Index",receiver:t,argument:e,evaluate:function(t){return this.receiver.evaluate(t)[this.argument.evaluate(t)]},getIds:function(t){return this.receiver.getIds(t),t}}},t.prototype.ternary=function(t,e,r){return{type:"Ternary",condition:t,trueExpr:e,falseExpr:r,evaluate:function(t){var e=this.condition.evaluate(t);return e?this.trueExpr.evaluate(t):this.falseExpr.evaluate(t)},getIds:function(t){return this.condition.getIds(t),this.trueExpr.getIds(t),this.falseExpr.getIds(t),t}}},t.prototype.map=function(t){return{type:"Map",entries:t,evaluate:function(e){var r={};for(var n in t)r[n]=this.entries[n].evaluate(e);return r},getIds:function(e){for(var r in t)this.entries[r].getIds(e);return e}}},t.prototype.list=function(t){return{type:"List",items:t,evaluate:function(t){return this.items.map(function(e){return e.evaluate(t)})},getIds:function(t){return this.items.forEach(function(e){return e.getIds(t)}),t}}},t}();e.EvalAstFactory=i}),define("polymer-expressions/parser",["require","exports"],function(t,e){"use strict";function r(t,e,r){return{kind:t,value:e,precedence:r||0}}function n(t){return/^\s$/.test(t)}function i(t){return/^[a-zA-Z_$]$/.test(t)}function s(t){return/^[a-zA-Z0-9_$]$/.test(t)}function a(t){return-1!==E.indexOf(t)}function o(t){return/^[\"\']$/.test(t)}function u(t){return/^[0-9]$/.test(t)}function h(t){return-1!==l.indexOf(t)}function c(t){return-1!==v.indexOf(t)}function p(t){return t.replace(/\\(.)/g,function(t,e){switch(e){case"n":return"\n";case"r":return"\r";case"t":return"	";case"b":return"\b";case"f":return"\f";default:return e}})}function f(t,e){return new O(t,e).parse()}var v="()[]{}",l="+-*/!&%<=>?^|",d=["==","!=","<=",">=","||","&&"],y=["===","!=="],E=["this"],x=["+","-","!"],I=["+","-","*","/","%","^","==","!=",">","<",">=","<=","||","&&","&","===","!==","|"];e.PRECEDENCE={"!":0,":":0,",":0,")":0,"]":0,"}":0,"?":1,"||":2,"&&":3,"|":4,"^":5,"&":6,"!=":7,"==":7,"!==":7,"===":7,">=":8,">":8,"<=":8,"<":8,"+":9,"-":9,"%":10,"/":10,"*":10,"(":11,"[":11,".":11,"{":11},e.POSTFIX_PRECEDENCE=11,e.STRING=1,e.IDENTIFIER=2,e.DOT=3,e.COMMA=4,e.COLON=5,e.INTEGER=6,e.DECIMAL=7,e.OPERATOR=8,e.GROUPER=9,e.KEYWORD=10,e.token=r;var k=function(){function t(t){this.index=-1,this.tokenStart=0,this.next=null,this.input=t}return t.prototype.advance=function(t){this.index<this.input.length?(this.index++,this.next=this.input[this.index],t&&(this.tokenStart=this.index)):this.next=null},t.prototype.getValue=function(t){var e=this.input.substring(this.tokenStart,this.index+(t||0));return t||this.clearValue(),e},t.prototype.clearValue=function(){this.tokenStart=this.index},t.prototype.nextToken=function(){for(-1===this.index&&this.advance();n(this.next);)this.advance(!0);return o(this.next)?this.tokenizeString():i(this.next)?this.tokenizeIdentOrKeyword():u(this.next)?this.tokenizeNumber():"."===this.next?this.tokenizeDot():","===this.next?this.tokenizeComma():":"===this.next?this.tokenizeColon():h(this.next)?this.tokenizeOperator():c(this.next)?this.tokenizeGrouper():(this.advance(),null)},t.prototype.tokenizeString=function(){var t="unterminated string",n=this.next;for(this.advance(!0);this.next!==n;){if(!this.next)throw new Error(t);if("\\"===this.next&&(this.advance(),!this.next))throw new Error(t);this.advance()}var i=r(e.STRING,p(this.getValue()));return this.advance(),i},t.prototype.tokenizeIdentOrKeyword=function(){for(;s(this.next);)this.advance();var t=this.getValue(),n=a(t)?e.KEYWORD:e.IDENTIFIER;return r(n,t)},t.prototype.tokenizeNumber=function(){for(;u(this.next);)this.advance();return"."===this.next?this.tokenizeDot():r(e.INTEGER,this.getValue())},t.prototype.tokenizeDot=function(){return this.advance(),u(this.next)?this.tokenizeFraction():(this.clearValue(),r(e.DOT,".",e.POSTFIX_PRECEDENCE))},t.prototype.tokenizeComma=function(){return this.advance(!0),r(e.COMMA,",")},t.prototype.tokenizeColon=function(){return this.advance(!0),r(e.COLON,":")},t.prototype.tokenizeFraction=function(){for(;u(this.next);)this.advance();return r(e.DECIMAL,this.getValue())},t.prototype.tokenizeOperator=function(){this.advance();var t=this.getValue(2);return-1!==y.indexOf(t)?(this.advance(),this.advance()):(t=this.getValue(1),-1!==d.indexOf(t)&&this.advance()),t=this.getValue(),r(e.OPERATOR,t,e.PRECEDENCE[t])},t.prototype.tokenizeGrouper=function(){var t=this.next,n=r(e.GROUPER,t,e.PRECEDENCE[t]);return this.advance(!0),n},t}();e.Tokenizer=k,e.parse=f;var O=function(){function t(t,e){this.tokenizer=new k(t),this.ast=e,this.token=null,this.kind=null,this.value=null}return t.prototype.parse=function(){return this.advance(),this.parseExpression()},t.prototype.advance=function(t,e){if(!this.matches(t,e))throw new Error("Expected kind "+t+" ("+e+"), was "+this.token);var r=this.tokenizer.nextToken();this.token=r,this.kind=r&&r.kind,this.value=r&&r.value},t.prototype.matches=function(t,e){return!(t&&this.kind!=t||e&&this.value!==e)},t.prototype.parseExpression=function(){if(!this.token)return this.ast.empty();var t=this.parseUnary();return t?this.parsePrecedence(t,0):null},t.prototype.parsePrecedence=function(t,r){for(;this.token;)if(this.matches(e.GROUPER,"(")){var n=this.parseArguments();t=this.ast.invoke(t,null,n)}else if(this.matches(e.GROUPER,"[")){var i=this.parseIndex();t=this.ast.index(t,i)}else if(this.matches(e.DOT)){this.advance();var s=this.parseUnary();t=this.makeInvokeOrGetter(t,s)}else{if(this.matches(e.KEYWORD))break;if(!(this.matches(e.OPERATOR)&&this.token.precedence>=r))break;t="?"==this.value?this.parseTernary(t):this.parseBinary(t)}return t},t.prototype.makeInvokeOrGetter=function(t,e){if("ID"===e.type)return this.ast.getter(t,e.value);if("Invoke"===e.type&&"ID"===e.receiver.type){var r=e,n=r.receiver;return this.ast.invoke(t,n.value,r.arguments)}throw new Error("expected identifier: "+e)},t.prototype.parseBinary=function(t){var r=this.token;if(-1===I.indexOf(r.value))throw new Error("unknown operator: "+r.value);this.advance();for(var n=this.parseUnary();(this.kind==e.OPERATOR||this.kind==e.DOT||this.kind==e.GROUPER)&&this.token.precedence>r.precedence;)n=this.parsePrecedence(n,this.token.precedence);return this.ast.binary(t,r.value,n)},t.prototype.parseUnary=function(){if(this.matches(e.OPERATOR)){var t=this.value;if(this.advance(),"+"===t||"-"===t){if(this.matches(e.INTEGER))return this.parseInteger(t);if(this.matches(e.DECIMAL))return this.parseDecimal(t)}if(-1===x.indexOf(t))throw new Error("unexpected token: "+t);var r=this.parsePrecedence(this.parsePrimary(),e.POSTFIX_PRECEDENCE);return this.ast.unary(t,r)}return this.parsePrimary()},t.prototype.parseTernary=function(t){this.advance(e.OPERATOR,"?");var r=this.parseExpression();this.advance(e.COLON);var n=this.parseExpression();return this.ast.ternary(t,r,n)},t.prototype.parsePrimary=function(){switch(this.kind){case e.KEYWORD:var t=this.value;if("this"===t)return this.advance(),this.ast.id(t);if(-1!==E.indexOf(t))throw new Error("unexpected keyword: "+t);throw new Error("unrecognized keyword: "+t);case e.IDENTIFIER:return this.parseInvokeOrIdentifier();case e.STRING:return this.parseString();case e.INTEGER:return this.parseInteger();case e.DECIMAL:return this.parseDecimal();case e.GROUPER:return"("==this.value?this.parseParen():"{"==this.value?this.parseMap():"["==this.value?this.parseList():null;case e.COLON:throw new Error('unexpected token ":"');default:return null}},t.prototype.parseList=function(){var t=[];do{if(this.advance(),this.matches(e.GROUPER,"]"))break;t.push(this.parseExpression())}while(this.matches(e.COMMA));return this.advance(e.GROUPER,"]"),this.ast.list(t)},t.prototype.parseMap=function(){var t={};do{if(this.advance(),this.matches(e.GROUPER,"}"))break;var r=this.value;this.advance(e.STRING),this.advance(e.COLON),t[r]=this.parseExpression()}while(this.matches(e.COMMA));return this.advance(e.GROUPER,"}"),this.ast.map(t)},t.prototype.parseInvokeOrIdentifier=function(){var t=this.value;if("true"===t)return this.advance(),this.ast.literal(!0);if("false"===t)return this.advance(),this.ast.literal(!1);if("null"==t)return this.advance(),this.ast.literal(null);var e=this.parseIdentifier(),r=this.parseArguments();return r?this.ast.invoke(e,null,r):e},t.prototype.parseIdentifier=function(){if(!this.matches(e.IDENTIFIER))throw new Error("expected identifier: "+this.value);var t=this.value;return this.advance(),this.ast.id(t)},t.prototype.parseArguments=function(){if(this.matches(e.GROUPER,"(")){var t=[];do{if(this.advance(),this.matches(e.GROUPER,")"))break;var r=this.parseExpression();t.push(r)}while(this.matches(e.COMMA));return this.advance(e.GROUPER,")"),t}return null},t.prototype.parseIndex=function(){if(this.matches(e.GROUPER,"[")){this.advance();var t=this.parseExpression();return this.advance(e.GROUPER,"]"),t}return null},t.prototype.parseParen=function(){this.advance();var t=this.parseExpression();return this.advance(e.GROUPER,")"),this.ast.paren(t)},t.prototype.parseString=function(){var t=this.ast.literal(this.value);return this.advance(),t},t.prototype.parseInteger=function(t){t=t||"";var e=this.ast.literal(parseInt(""+t+this.value,10));return this.advance(),e},t.prototype.parseDecimal=function(t){t=t||"";var e=this.ast.literal(parseFloat(""+t+this.value));return this.advance(),e},t}();e.Parser=O});